--
-- PostgreSQL database dump
--

-- Dumped from database version 17.4 (Debian 17.4-1.pgdg120+2)
-- Dumped by pg_dump version 17.4 (Debian 17.4-1.pgdg120+2)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: app_user; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.app_user (
    id bigint NOT NULL,
    email character varying(255) NOT NULL,
    name character varying(100) NOT NULL,
    phone character varying(20)
);


ALTER TABLE public.app_user OWNER TO library_admin;

--
-- Name: app_user_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.app_user ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.app_user_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: author; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.author (
    id bigint NOT NULL,
    name character varying(100) NOT NULL
);


ALTER TABLE public.author OWNER TO library_admin;

--
-- Name: author_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.author ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.author_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: book; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.book (
    id bigint NOT NULL,
    title character varying(255) NOT NULL,
    unique_code character varying(20) NOT NULL,
    author_id bigint NOT NULL,
    category_id bigint NOT NULL
);


ALTER TABLE public.book OWNER TO library_admin;

--
-- Name: book_copy; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.book_copy (
    id bigint NOT NULL,
    onloan boolean,
    unique_identifier character varying(20) NOT NULL,
    book_id bigint NOT NULL,
    purchased boolean
);


ALTER TABLE public.book_copy OWNER TO library_admin;

--
-- Name: book_copy_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.book_copy ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.book_copy_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: book_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.book ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.book_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: category; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.category (
    id bigint NOT NULL,
    name character varying(255) NOT NULL
);


ALTER TABLE public.category OWNER TO library_admin;

--
-- Name: category_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.category ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.category_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: loan; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.loan (
    id bigint NOT NULL,
    due_date date NOT NULL,
    return_date date,
    start_date date NOT NULL,
    book_copy_id bigint NOT NULL,
    user_id bigint NOT NULL
);


ALTER TABLE public.loan OWNER TO library_admin;

--
-- Name: loan_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.loan ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.loan_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: purchase_history; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.purchase_history (
    id bigint NOT NULL,
    amount numeric(38,2) NOT NULL,
    date date NOT NULL,
    method character varying(255) NOT NULL,
    payment_id character varying(50),
    book_copy_id bigint NOT NULL,
    user_id bigint NOT NULL
);


ALTER TABLE public.purchase_history OWNER TO library_admin;

--
-- Name: purchase_history_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.purchase_history ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.purchase_history_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: review; Type: TABLE; Schema: public; Owner: library_admin
--

CREATE TABLE public.review (
    id bigint NOT NULL,
    comment character varying(255),
    rating integer NOT NULL,
    book_id bigint NOT NULL,
    user_id bigint NOT NULL,
    CONSTRAINT review_rating_check CHECK (((rating >= 1) AND (rating <= 5)))
);


ALTER TABLE public.review OWNER TO library_admin;

--
-- Name: review_id_seq; Type: SEQUENCE; Schema: public; Owner: library_admin
--

ALTER TABLE public.review ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.review_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Data for Name: app_user; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.app_user (id, email, name, phone) FROM stdin;
1	juan.perez@example.com	Juan Pérez	123456789
2	ana.gomez@example.com	Ana Gómez	987654321
3	carlos.ramirez@example.com	Carlos Ramírez	456123789
4	laura.martinez@example.com	Laura Martínez	741852963
\.


--
-- Data for Name: author; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.author (id, name) FROM stdin;
1	Gabriel García Márquez
2	Isaac Asimov
4	Stephen King
5	Yuval Noah Harari
6	Creado apidog
3	Juan Pedro
\.


--
-- Data for Name: book; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.book (id, title, unique_code, author_id, category_id) FROM stdin;
1	Cien años de soledad	BOOK001	1	1
3	Harry Potter y la piedra filosofal	BOOK003	3	5
4	It	BOOK004	4	4
5	Sapiens	BOOK005	5	3
6	Ejemplo de insersion	BOOK124213	1	2
9	Libro sda	36	3	3
2	Otorrino	BOOK002	2	2
\.


--
-- Data for Name: book_copy; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.book_copy (id, onloan, unique_identifier, book_id, purchased) FROM stdin;
2	t	COPY002	1	f
5	f	COPY005	3	f
6	f	COPY006	4	f
7	t	COPY007	5	f
8	f	COPY986	1	f
10	f	COPY300	3	f
11	f	COPY816	3	f
3	t	COPY003	2	t
4	f	COPY004	3	f
1	f	COPY001	1	t
\.


--
-- Data for Name: category; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.category (id, name) FROM stdin;
1	Ficción
2	Ciencia
3	Historia
4	Misterio
5	Fantasía
\.


--
-- Data for Name: loan; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.loan (id, due_date, return_date, start_date, book_copy_id, user_id) FROM stdin;
1	2025-03-15	\N	2025-03-01	2	1
4	2025-04-03	\N	2025-04-16	3	1
2	2025-03-20	2025-03-18	2025-03-05	4	2
3	2025-04-15	2025-03-18	2025-04-01	1	1
\.


--
-- Data for Name: purchase_history; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.purchase_history (id, amount, date, method, payment_id, book_copy_id, user_id) FROM stdin;
5	29.99	2025-03-10	Tarjeta de crédito	PAY123	1	1
6	19.99	2025-03-11	PayPal	PAY124	3	2
\.


--
-- Data for Name: review; Type: TABLE DATA; Schema: public; Owner: library_admin
--

COPY public.review (id, comment, rating, book_id, user_id) FROM stdin;
1	Un libro fascinante	5	1	1
2	Me dio mucho miedo, excelente historia	4	2	2
4	Esta de locos este libro actualizado	4	3	3
\.


--
-- Name: app_user_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.app_user_id_seq', 4, true);


--
-- Name: author_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.author_id_seq', 8, true);


--
-- Name: book_copy_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.book_copy_id_seq', 11, true);


--
-- Name: book_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.book_id_seq', 9, true);


--
-- Name: category_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.category_id_seq', 6, true);


--
-- Name: loan_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.loan_id_seq', 4, true);


--
-- Name: purchase_history_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.purchase_history_id_seq', 6, true);


--
-- Name: review_id_seq; Type: SEQUENCE SET; Schema: public; Owner: library_admin
--

SELECT pg_catalog.setval('public.review_id_seq', 4, true);


--
-- Name: app_user app_user_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.app_user
    ADD CONSTRAINT app_user_pkey PRIMARY KEY (id);


--
-- Name: author author_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.author
    ADD CONSTRAINT author_pkey PRIMARY KEY (id);


--
-- Name: book_copy book_copy_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book_copy
    ADD CONSTRAINT book_copy_pkey PRIMARY KEY (id);


--
-- Name: book book_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book
    ADD CONSTRAINT book_pkey PRIMARY KEY (id);


--
-- Name: category category_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.category
    ADD CONSTRAINT category_pkey PRIMARY KEY (id);


--
-- Name: loan loan_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.loan
    ADD CONSTRAINT loan_pkey PRIMARY KEY (id);


--
-- Name: purchase_history purchase_history_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.purchase_history
    ADD CONSTRAINT purchase_history_pkey PRIMARY KEY (id);


--
-- Name: review review_pkey; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.review
    ADD CONSTRAINT review_pkey PRIMARY KEY (id);


--
-- Name: app_user uk1j9d9a06i600gd43uu3km82jw; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.app_user
    ADD CONSTRAINT uk1j9d9a06i600gd43uu3km82jw UNIQUE (email);


--
-- Name: purchase_history uk6i4oqlqjw3o2id9503xwwrnjd; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.purchase_history
    ADD CONSTRAINT uk6i4oqlqjw3o2id9503xwwrnjd UNIQUE (payment_id);


--
-- Name: book ukgh3m8txkb2r4b1h6q6h9r8tr3; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book
    ADD CONSTRAINT ukgh3m8txkb2r4b1h6q6h9r8tr3 UNIQUE (unique_code);


--
-- Name: book_copy ukt3x4p5t64y3bpnlbtnquq5gyl; Type: CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book_copy
    ADD CONSTRAINT ukt3x4p5t64y3bpnlbtnquq5gyl UNIQUE (unique_identifier);


--
-- Name: review fk70yrt09r4r54tcgkrwbeqenbs; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.review
    ADD CONSTRAINT fk70yrt09r4r54tcgkrwbeqenbs FOREIGN KEY (book_id) REFERENCES public.book(id);


--
-- Name: purchase_history fk7f3tmuxorsnmwa4kl1fry9d52; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.purchase_history
    ADD CONSTRAINT fk7f3tmuxorsnmwa4kl1fry9d52 FOREIGN KEY (user_id) REFERENCES public.app_user(id);


--
-- Name: book fkam9riv8y6rjwkua1gapdfew4j; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book
    ADD CONSTRAINT fkam9riv8y6rjwkua1gapdfew4j FOREIGN KEY (category_id) REFERENCES public.category(id);


--
-- Name: purchase_history fkb78evadiddmp7u1lybvau4nbt; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.purchase_history
    ADD CONSTRAINT fkb78evadiddmp7u1lybvau4nbt FOREIGN KEY (book_copy_id) REFERENCES public.book_copy(id);


--
-- Name: review fkc7y0l3wac4n2ewm6a2uecd54c; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.review
    ADD CONSTRAINT fkc7y0l3wac4n2ewm6a2uecd54c FOREIGN KEY (user_id) REFERENCES public.app_user(id);


--
-- Name: loan fkhq4lfr6shkjcbqvn0if6sqtwf; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.loan
    ADD CONSTRAINT fkhq4lfr6shkjcbqvn0if6sqtwf FOREIGN KEY (book_copy_id) REFERENCES public.book_copy(id);


--
-- Name: loan fkjcauugddigslh9xi7v2n9tiwj; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.loan
    ADD CONSTRAINT fkjcauugddigslh9xi7v2n9tiwj FOREIGN KEY (user_id) REFERENCES public.app_user(id);


--
-- Name: book fkklnrv3weler2ftkweewlky958; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book
    ADD CONSTRAINT fkklnrv3weler2ftkweewlky958 FOREIGN KEY (author_id) REFERENCES public.author(id);


--
-- Name: book_copy fkpqftp65hd66ae8wsx7pp2cxcs; Type: FK CONSTRAINT; Schema: public; Owner: library_admin
--

ALTER TABLE ONLY public.book_copy
    ADD CONSTRAINT fkpqftp65hd66ae8wsx7pp2cxcs FOREIGN KEY (book_id) REFERENCES public.book(id);


--
-- PostgreSQL database dump complete
--

